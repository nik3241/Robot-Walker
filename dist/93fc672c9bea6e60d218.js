"use strict";import*as THREE from"three";import*as CANNON from"cannon-es";import CannonDebugRenderer from"./app/utils/CannonDebugRenderer";import CannonUtils from"./app/utils/cannonUtils";import Stats from"three/addons/libs/stats.module.js";import"./styles/all.css";import{Game}from"./app/Game";import{Terrain}from"./app/objects/Terrain";import{BotModel}from"./app/objects/Bot/BotModel";import{OrbitControls}from"three/examples/jsm/Addons.js";import{GameCamera}from"./app/objects/GameCamera";import{LowPolyTrees}from"./app/objects/Trees/LowPolyTrees";const _DEBUG=!0;async function main(){const e=document.getElementById("game"),o=new Game(e);let n;const t=o.phisicsWorld;window.myGame=o;const a=new Stats;a.domElement.style="position: absolute; top: 3px; left: 3px; cursor: pointer; opacity: 0.9; z-index: 10000;",console.log(),e.children[0].appendChild(a.domElement);const d=o.gui.addFolder("General"),r=o.gui.addFolder("Helpers").close(),s=o.gui.addFolder("Objects"),i=o.gui.addFolder("Lights").close();o.displayMenuStart(),function(){const e=o.phisicsWorld.gravity,a=o.gui.addFolder("Physics");a.add(e,"x",-10,10,.1),a.add(e,"y",-10,10,.1),a.add(e,"z",-10,10,.1),a.open(),n=new CannonDebugRenderer(o.scene,t)}(),o.camera.position.set(0,0,0),o.camera.rotation.set(0,0,0),d.reset().add(o,"statisticsVisible").onChange((()=>{o.toggleStatistics(),f(o.camera)})),o.lights.children.forEach(((e,o)=>{const n=i.addFolder(e.type+o);n.add(e,"intensity").name("intensity").step(.01),n.addColor(e,"color",255)})),o.helpers.add(new THREE.PointLightHelper(o.scene.children[0].children[1],5)),o.helpers.add(new THREE.PointLightHelper(o.scene.children[0].children[2],5)),o.helpers.add(new THREE.AxesHelper),o.helpers.add(new THREE.GridHelper(10,10,505418,9963445)),r.add(o.helpers,"visible").name("Отображение помощников"),r.close(),o.helpers.children.forEach((e=>{r.add(e,"visible").name(e.type)}));const l=new BotModel(o);o.objects.add(l),await l.loadModel(),d.add(l.position,"x"),d.add(l.position,"y"),d.add(l.position,"z"),d.add(l.rotation,"x"),d.add(l.rotation,"y"),d.add(l.rotation,"z"),s.add(l,"visible").name("робот"),l.add(new THREE.AxesHelper(3)).add(o.lights.children.at(-1)),o.controls.push(l.controls),o.addPhisicsBody(l.body,"bot");const c=function(){const e=(new THREE.TextureLoader).setPath("/").load("grass.png"),o=new THREE.PlaneGeometry(250,250,10,10),n=new THREE.MeshStandardMaterial({color:15658734,map:e,metalness:1});n.map.repeat.set(40,40),n.map.wrapS=n.map.wrapT=THREE.RepeatWrapping;const t=new THREE.Mesh(o,n);return t.name="Plane",t.receiveShadow=!0,t}();s.add(c,"visible").name("Плоскость"),o.objects.add(c);var m=function(e){var o=new CANNON.Body({mass:0}),n=new CANNON.Plane;return o.addShape(n),o.quaternion.setFromEuler(-Math.PI/2,0,0),o.position.y=-.2,e.position.copy(o.position),e.quaternion.copy(o.quaternion),o}(c);t.addBody(m),H(c,m);const p=new LowPolyTrees,h=new THREE.Group;o.objects.add(h);for(let e=0;e<15;e++)h.add(p.getTree("",new THREE.Vector3(p._getRandomArbitrary(0,45),0,p._getRandomArbitrary(0,45))));const E=function(e=5){const n=[],a=new THREE.MeshStandardMaterial({color:16777215*Math.random(),flatShading:!0,name:"Box_mtl"});for(let d=0;d<e;d++){const e=new CANNON.Vec3(2*Math.random(),2*Math.random(),2*Math.random()),d=new CANNON.Box(e),r=new THREE.BoxGeometry(2*e.x,2*e.y,2*e.z),s=20*(Math.random()-.5),i=2*e.y+20*Math.random(),l=20*(Math.random()-.5),c=new CANNON.Body({mass:1});c.addShape(d),c.position.set(s,i,l),t.addBody(c);const m=new THREE.Mesh(r,a);o.scene.add(m),m.castShadow=!0,m.receiveShadow=!0,n.push({mesh:m,body:c})}return n}(),u=function(e=5){const n=[],a=new THREE.MeshStandardMaterial({color:16777215*Math.random(),flatShading:!0,name:"Icosahedron_mtl"});for(let d=0;d<e;d++){const e=new THREE.IcosahedronGeometry(.5+3*Math.random(),0),d=CannonUtils.CreateConvexPolyhedron(e),r=20*(Math.random()-.5)-10,s=8*Math.random(),i=20*(Math.random()-.5)-10,l=new CANNON.Body({mass:.5+5*Math.random()});l.addShape(d),l.position.set(r,s,i),t.addBody(l);const c=new THREE.Mesh(e,a);o.scene.add(c),c.castShadow=!0,c.receiveShadow=!0,n.push({mesh:c,body:l})}return n}(),w=new CANNON.Body({mass:1,shape:new CANNON.Box(new CANNON.Vec3(1,1,1))});t.addBody(w),w.position.set(0,2.5,4),console.log("кубик физическое тело",w);const y=new THREE.BoxGeometry(2,2,2),g=new THREE.MeshStandardMaterial({color:16777215*Math.random(),flatShading:!0,name:"Cube_mtl"}),M=new THREE.Mesh(y,g);M.name="Cube",M.castShadow=!0,o.scene.add(M),console.warn(t),s.add(M,"visible").name("Куб");const b=new THREE.AxesHelper(10);function f(){let e=o.canvas.parentNode;console.log(this),console.log(o.camera),o.camera.aspect=e.clientWidth/e.clientHeight,o.camera.updateProjectionMatrix(),o.renderer.setSize(e.clientWidth,e.clientHeight,!1),o.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))}function H(e,o){e.position.set(o.position.x,o.position.y,o.position.z),e.quaternion.set(o.quaternion.x,o.quaternion.y,o.quaternion.z,o.quaternion.w)}b.name="boxLocalAxis",M.add(b),o.renderer.setAnimationLoop((function(){const e=o.clock.getDelta();l.update(e),H(M,w);for(let e=0;e<E.length;e++)H(E[e].mesh,E[e].body);for(let e=0;e<u.length;e++)H(u[e].mesh,u[e].body);for(let e=0;e<(0).length;e++)H((0)[e].mesh,(0)[e].body);t.step(e),n.update(),a.update(),o.renderer.render(o.scene,o.camera)})),f(o.camera),console.log(n),window.addEventListener("resize",f),o.canvas.addEventListener("dblclick",(e=>{e.target===o.canvas&&(document.fullscreenElement?(document.exitFullscreen(),f()):(o.canvas.requestFullscreen(),f()))}))}document.addEventListener("DOMContentLoaded",main);